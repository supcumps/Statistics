#tag DesktopWindow
Begin DesktopWindow MultiHeaderWindow
   Backdrop        =   0
   BackgroundColor =   &cFFFFFF
   Composite       =   False
   DefaultLocation =   2
   FullScreen      =   False
   HasBackgroundColor=   False
   HasCloseButton  =   True
   HasFullScreenButton=   False
   HasMaximizeButton=   True
   HasMinimizeButton=   True
   HasTitleBar     =   True
   Height          =   688
   ImplicitInstance=   True
   MacProcID       =   0
   MaximumHeight   =   32000
   MaximumWidth    =   32000
   MenuBar         =   ""
   MenuBarVisible  =   False
   MinimumHeight   =   64
   MinimumWidth    =   64
   Resizeable      =   True
   Title           =   "Statistical Analysis Demonstration"
   Type            =   0
   Visible         =   True
   Width           =   816
   Begin DesktopBevelButton PieBevelButton
      Active          =   False
      AllowAutoDeactivate=   True
      AllowFocus      =   True
      AllowTabStop    =   True
      BackgroundColor =   &c00000000
      BevelStyle      =   0
      Bold            =   False
      ButtonStyle     =   0
      Caption         =   "Pie Chart"
      CaptionAlignment=   3
      CaptionDelta    =   0
      CaptionPosition =   1
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      HasBackgroundColor=   False
      Height          =   22
      Icon            =   0
      IconAlignment   =   0
      IconDeltaX      =   0
      IconDeltaY      =   0
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   False
      Left            =   7
      LockBottom      =   False
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   False
      LockTop         =   True
      MenuStyle       =   0
      PanelIndex      =   0
      Scope           =   0
      TabIndex        =   1
      TabPanelIndex   =   0
      TextColor       =   &c00000000
      Tooltip         =   ""
      Top             =   241
      Transparent     =   False
      Underline       =   False
      Value           =   False
      Visible         =   True
      Width           =   160
      _mIndex         =   0
      _mInitialParent =   ""
      _mName          =   ""
      _mPanelIndex    =   0
   End
   Begin DesktopImageViewer ImageViewer1
      Active          =   False
      AllowAutoDeactivate=   True
      AllowTabStop    =   True
      Enabled         =   True
      Height          =   538
      Image           =   0
      Index           =   -2147483648
      InitialParent   =   ""
      Left            =   197
      LockBottom      =   True
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   True
      LockTop         =   True
      PanelIndex      =   0
      Scope           =   0
      TabIndex        =   8
      TabPanelIndex   =   0
      Tooltip         =   ""
      Top             =   142
      Transparent     =   False
      Visible         =   True
      Width           =   587
      _mIndex         =   0
      _mInitialParent =   ""
      _mName          =   ""
      _mPanelIndex    =   0
   End
   Begin DesktopListBox ResultsListBox
      AllowAutoDeactivate=   True
      AllowAutoHideScrollbars=   True
      AllowExpandableRows=   False
      AllowFocusRing  =   True
      AllowResizableColumns=   False
      AllowRowDragging=   False
      AllowRowReordering=   False
      Bold            =   False
      ColumnCount     =   0
      ColumnWidths    =   ""
      DefaultRowHeight=   -1
      DropIndicatorVisible=   False
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      GridLineStyle   =   0
      HasBorder       =   True
      HasHeader       =   True
      HasHorizontalScrollbar=   True
      HasVerticalScrollbar=   True
      HeadingIndex    =   -1
      Height          =   103
      Index           =   -2147483648
      InitialValue    =   ""
      Italic          =   False
      Left            =   20
      LockBottom      =   False
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   False
      LockTop         =   True
      RequiresSelection=   False
      RowSelectionType=   0
      Scope           =   2
      TabIndex        =   9
      TabPanelIndex   =   0
      TabStop         =   True
      Tooltip         =   ""
      Top             =   20
      Transparent     =   False
      Underline       =   False
      Visible         =   True
      Width           =   776
      _ScrollOffset   =   0
      _ScrollWidth    =   -1
   End
   Begin DesktopBevelButton PieBevelButton1
      Active          =   False
      AllowAutoDeactivate=   True
      AllowFocus      =   True
      AllowTabStop    =   True
      BackgroundColor =   &c00000000
      BevelStyle      =   0
      Bold            =   False
      ButtonStyle     =   0
      Caption         =   "Spider Plot"
      CaptionAlignment=   3
      CaptionDelta    =   0
      CaptionPosition =   1
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      HasBackgroundColor=   False
      Height          =   22
      Icon            =   0
      IconAlignment   =   0
      IconDeltaX      =   0
      IconDeltaY      =   0
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   False
      Left            =   7
      LockBottom      =   False
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   False
      LockTop         =   True
      MenuStyle       =   0
      PanelIndex      =   0
      Scope           =   0
      TabIndex        =   10
      TabPanelIndex   =   0
      TextColor       =   &c00000000
      Tooltip         =   ""
      Top             =   275
      Transparent     =   False
      Underline       =   False
      Value           =   False
      Visible         =   True
      Width           =   160
      _mIndex         =   0
      _mInitialParent =   ""
      _mName          =   ""
      _mPanelIndex    =   0
   End
   Begin DesktopBevelButton SPMatrixButton
      Active          =   False
      AllowAutoDeactivate=   True
      AllowFocus      =   True
      AllowTabStop    =   True
      BackgroundColor =   &c00000000
      BevelStyle      =   0
      Bold            =   False
      ButtonStyle     =   0
      Caption         =   "Scatterplot Matrix"
      CaptionAlignment=   3
      CaptionDelta    =   0
      CaptionPosition =   1
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      HasBackgroundColor=   False
      Height          =   22
      Icon            =   0
      IconAlignment   =   0
      IconDeltaX      =   0
      IconDeltaY      =   0
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   False
      Left            =   7
      LockBottom      =   False
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   False
      LockTop         =   True
      MenuStyle       =   0
      PanelIndex      =   0
      Scope           =   0
      TabIndex        =   11
      TabPanelIndex   =   0
      TextColor       =   &c00000000
      Tooltip         =   ""
      Top             =   309
      Transparent     =   False
      Underline       =   False
      Value           =   False
      Visible         =   True
      Width           =   160
      _mIndex         =   0
      _mInitialParent =   ""
      _mName          =   ""
      _mPanelIndex    =   0
   End
   Begin DesktopBevelButton SPMatrixButton1
      Active          =   False
      AllowAutoDeactivate=   True
      AllowFocus      =   True
      AllowTabStop    =   True
      BackgroundColor =   &c00000000
      BevelStyle      =   0
      Bold            =   False
      ButtonStyle     =   0
      Caption         =   "Scatterplot Matrix"
      CaptionAlignment=   3
      CaptionDelta    =   0
      CaptionPosition =   1
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      HasBackgroundColor=   False
      Height          =   22
      Icon            =   0
      IconAlignment   =   0
      IconDeltaX      =   0
      IconDeltaY      =   0
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   False
      Left            =   7
      LockBottom      =   False
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   False
      LockTop         =   True
      MenuStyle       =   0
      PanelIndex      =   0
      Scope           =   0
      TabIndex        =   12
      TabPanelIndex   =   0
      TextColor       =   &c00000000
      Tooltip         =   ""
      Top             =   350
      Transparent     =   False
      Underline       =   False
      Value           =   False
      Visible         =   True
      Width           =   160
      _mIndex         =   0
      _mInitialParent =   ""
      _mName          =   ""
      _mPanelIndex    =   0
   End
   Begin DesktopBevelButton Heatmap_BevelButton
      Active          =   False
      AllowAutoDeactivate=   True
      AllowFocus      =   True
      AllowTabStop    =   True
      BackgroundColor =   &c00000000
      BevelStyle      =   0
      Bold            =   False
      ButtonStyle     =   0
      Caption         =   "Correlation Heatmap"
      CaptionAlignment=   3
      CaptionDelta    =   0
      CaptionPosition =   1
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      HasBackgroundColor=   False
      Height          =   22
      Icon            =   0
      IconAlignment   =   0
      IconDeltaX      =   0
      IconDeltaY      =   0
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   False
      Left            =   7
      LockBottom      =   False
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   False
      LockTop         =   True
      MenuStyle       =   0
      PanelIndex      =   0
      Scope           =   0
      TabIndex        =   13
      TabPanelIndex   =   0
      TextColor       =   &c00000000
      Tooltip         =   ""
      Top             =   394
      Transparent     =   False
      Underline       =   False
      Value           =   False
      Visible         =   True
      Width           =   160
      _mIndex         =   0
      _mInitialParent =   ""
      _mName          =   ""
      _mPanelIndex    =   0
   End
End
#tag EndDesktopWindow

#tag WindowCode
	#tag Event
		Sub Opening()
		  
		End Sub
	#tag EndEvent


	#tag Method, Flags = &h0
		Function ColorFromCorrelation(r As Double) As Color
		  Var scaled As Integer = Abs(r) * 64 // max tone intensity reduced from 255 to 64
		  
		  If r < 0 Then
		    // Soft reds (low saturation pinks to dusty reds)
		    Return Color.RGB(255, 200 - scaled, 200 - scaled)
		  Else
		    // Soft blues (light sky blue to steel blue)
		    Return Color.RGB(200 - scaled, 200 - scaled, 255)
		  End If
		  
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function ConvertToDoubles(dataDict As Dictionary, key As String) As Double()
		  Var result() As Double
		  If dataDict.HasKey(KEY) Then
		    Var rawValues() As String = dataDict.Value(key)
		    For Each Val As String In rawValues
		      Try
		        result.Add(CDbl(Val.Trim))
		      Catch
		        ' Skip invalid
		      End Try
		    Next
		  End If
		  Return result
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function CorrelationInterpretation(r As Double) As String
		  //Function CorrelationInterpretation(r As Double) As String
		  Select Case True
		  Case r >= 0.75 
		     Return "Strong positive"
		  Case r >= 0.4  
		     Return "Moderate positive"
		  Case r >= 0.1  
		    Return "Weak positive"
		  Case r <= -0.75
		    Return "Strong negative"
		  Case r <= -0.4 
		    Return "Moderate negative"
		  Case r <= -0.1 
		    Return "Weak negative"
		  Else           
		    Return "No correlation"
		  End Select
		  
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function CreateFullCorrelationHeatmapPicture(headers() As String, dataDict As Dictionary, cellSize As Integer = 80, labelWidth As Integer = 100, labelHeight As Integer = 40) As Picture
		  Var cols As Integer = headers.Count
		  Var width As Integer = labelWidth + cols * cellSize + 10
		  Var height As Integer = labelHeight + cols * cellSize + 40
		  
		  Var pic As New Picture(width, height)
		  Var g As Graphics = pic.Graphics
		  
		  g.FontSize = 12
		  g.Bold = True
		  
		  // Column headers
		  For col As Integer = 0 To cols - 1
		    Var xLabel As String = headers(col)
		    g.DrawString(xLabel, labelWidth + col * cellSize + cellSize / 2 - g.TextWidth(xLabel) / 2, 20)
		  Next
		  
		  // Row headers
		  For row As Integer = 0 To cols - 1
		    Var yLabel As String = headers(row)
		    g.DrawString(yLabel, 5, labelHeight + row * cellSize + cellSize / 2 + g.TextHeight / 2)
		  Next
		  
		  // Heatmap cells
		  For row As Integer = 0 To cols - 1
		    For col As Integer = 0 To cols - 1
		      Var xVals() As Double = ConvertToDoubles(dataDict, headers(col))
		      Var yVals() As Double = ConvertToDoubles(dataDict, headers(row))
		      Var r As Double = PearsonCorrelation(xVals, yVals)
		      
		      Var heatColor As Color = ColorFromCorrelation(r)
		      Var Left As Integer = labelWidth + col * cellSize
		      Var top As Integer = labelHeight + row * cellSize
		      
		      g.DrawingColor = heatColor
		      g.FillRectangle(Left, top, cellSize, cellSize)
		      g.DrawingColor = Color.Black
		      g.DrawRect(Left, top, cellSize, cellSize)
		      g.DrawString(Format(r, "-#.##"), Left + 5, top + 20)
		      
		      Var interp As String = CorrelationInterpretation(r)
		      g.FontSize = 10
		      g.DrawString(interp, Left + 5, top + cellSize - 8)
		      g.FontSize = 12
		    Next
		  Next
		  
		  Return pic
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function CreatePieChartImage(headers() As String, valuesDict As Dictionary, radius As Double) As Picture
		  Var picSize As Integer = radius * 2 +200
		  Var chartPic As New Picture(picSize, picSize)
		  Var g As Graphics = chartPic.Graphics
		  
		  Var cx As Integer = radius
		  Var cy As Integer = radius
		  
		  // Sum total from dictionary using Variant.TypeDouble
		  Var total As Double = 0.0
		  For Each key As Variant In valuesDict.Keys
		    total = total + valuesDict.Value(key).TypeDouble
		  Next
		  
		  Var startAngle As Double = 0.0
		  Var stepAngle As Double = 5.0
		  
		  For i As Integer = 0 To headers.LastIndex
		    Var header As String = headers(i)
		    Var value As Double = valuesDict.Lookup(header, 0.0).TypeDouble
		    If value = 0 Then Continue
		    
		    Var sweep As Double = value / total * 360.0
		    
		    // Create graphics path for pie slice
		    Var path As New GraphicsPath
		    path.MoveToPoint(cx, cy)
		    
		    For a As Double = startAngle To startAngle + sweep Step stepAngle
		      Var rad As Double = a * Pi / 180.0
		      Var x As Integer = Round(cx + Cos(rad) * radius)
		      Var y As Integer = Round(cy + Sin(rad) * radius)
		      path.AddLineToPoint(x, y)
		    Next
		    
		    // Final arc endpoint
		    Var endRad As Double = (startAngle + sweep) * Pi / 180.0
		    Var ex As Integer = Round(cx + Cos(endRad) * radius)
		    Var ey As Integer = Round(cy + Sin(endRad) * radius)
		    path.AddLineToPoint(ex, ey)
		    path.AddLineToPoint(cx, cy) // Explicitly close path
		    
		    // Set drawing color and fill the slice
		    Var hue As Double = i / headers.Count
		    Var baseColor As Color = Color.HSV(hue, 0.7, 0.9)
		    Var fadedColor As Color = Color.RGBA(baseColor.Red, baseColor.Green, baseColor.Blue, 128) // semi-transparent
		    
		    g.DrawingColor = fadedColor
		    g.FillPath(path, True)
		    
		    // Compute slice label with total and percentage
		    Var percent As Double = value / total * 100.0
		    Var label As String = header + " (" + Format(value, "#.##") + ", " + Format(percent, "#.0") + "%)"
		    
		    // Label position
		    Var midAngle As Double = startAngle + sweep / 2.0
		    Var lx As Integer = Round(cx + Cos(midAngle * Pi / 180.0) * radius * 0.6)
		    Var ly As Integer = Round(cy + Sin(midAngle * Pi / 180.0) * radius * 0.6)
		    g.DrawingColor = Color.Black
		    g.DrawText(label, lx - 15, ly, 100) // Extend width if needed
		    
		    
		    startAngle = startAngle + sweep
		  Next
		  
		  Return chartPic
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function CreateScatterplotMatrix(headers() as String, dataDict as Dictionary, cellsize as Integer = 100) As Picture
		  Var labelWidth As Integer = 150
		  Var labelHeight As Integer = 20
		  Var matrixSize As Integer = headers.Count * cellSize
		  Var picWidth As Integer = matrixSize + labelWidth + 10
		  Var picHeight As Integer = matrixSize + labelHeight + 30
		  
		  Var pic As New Picture(picWidth, picHeight)
		  Var g As Graphics = pic.Graphics
		  
		  For row As Integer = 0 To headers.LastIndex
		    For col As Integer = 0 To headers.LastIndex
		      Var xLabel As String = headers(col)
		      Var yLabel As String = headers(row)
		      
		      Var xVals() As Double = ConvertToDoubles(dataDict, xLabel)
		      Var yVals() As Double = ConvertToDoubles(dataDict, yLabel)
		      
		      Var cellLeft As Integer = col * cellSize + labelWidth
		      Var cellTop As Integer = row * cellSize + labelHeight
		      Var bounds As New Rect(cellLeft, cellTop, cellSize, cellSize)
		      
		      If xVals.Count > 0 And yVals.Count > 0 Then
		        DrawScatterCell(g, xVals, yVals, bounds)
		      Else
		        DrawDiagnosticOverlay(g, "n/a", bounds)
		      End If
		      
		      g.DrawRect(bounds.Left, bounds.Top, bounds.Width, bounds.Height)
		      DrawColumnTicks(g, bounds, 20)
		      DrawRowTicks(g, bounds, 20)
		      
		      If row = headers.LastIndex Then
		        Var xLabelX As Integer = bounds.Left + bounds.Width / 2 - g.TextWidth(xLabel) / 2
		        Var xLabelY As Integer = bounds.Bottom + 15
		        g.Bold = True
		        g.DrawText(xLabel, xLabelX, xLabelY)
		      End If
		      
		      If col = 0 Then
		        Var yLabelX As Integer = bounds.Left - g.TextWidth(yLabel) - 12
		        Var yLabelY As Integer = bounds.Top + bounds.Height / 2 + g.TextHeight / 2
		        g.Bold = True
		        g.DrawText(yLabel, yLabelX, yLabelY)
		      End If
		    Next
		  Next
		  
		  Return pic
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function CreateSpiderPlot(headers() As String, headerData As Dictionary, radius As Integer) As Picture
		  Var dimCount As Integer = headers.Count
		  If dimCount = 0 Then Return Nil
		  
		  Var picSize As Integer = radius * 2 +200
		  Var cx As Integer = picSize / 2
		  Var cy As Integer = picSize / 2
		  Var chartPic As New Picture(picSize, picSize)
		  Var g As Graphics = chartPic.Graphics
		  
		  // Normalize values and capture min/max
		  Var values() As Double
		  Var maxVal As Double = -1
		  Var minVal As Double = -1
		  Var minIdx, maxIdx As Integer
		  
		  For i As Integer = 0 To headers.LastIndex
		    Var key As String = headers(i)
		    Var Val As Double = headerData.Lookup(key, 0).TypeDouble
		    values.Add(Val)
		    
		    If Val > maxVal Or maxVal = -1 Then
		      maxVal = Val
		      maxIdx = i
		    End If
		    If Val < minVal Or minVal = -1 Then
		      minVal = Val
		      minIdx = i
		    End If
		  Next
		  
		  For i As Integer = 0 To values.LastIndex
		    If maxVal > 0 Then values(i) = values(i) / maxVal
		  Next
		  
		  // 🔘 Concentric rings with labels
		  Var ringCount As Integer = 5
		  g.DrawingColor = Color.DarkGray
		  g.PenWidth = 1.0
		  
		  For rLevel As Integer = 1 To ringCount
		    Var r As Integer = radius * rLevel / ringCount
		    g.DrawOval(cx - r, cy - r, r * 2, r * 2)
		    
		    Var labelVal As Double = rLevel * maxVal / ringCount
		    g.DrawingColor = Color.Purple
		    g.DrawText(Str(labelVal, "#.##"), cx + r + 6, cy - 6)
		  Next
		  
		  // 🧭 Radial gridlines + offset header labels
		  Var labelOffset As Integer = 40
		  For i As Integer = 0 To dimCount - 1
		    Var angle As Double = i / dimCount * 2.0 * Pi
		    Var axX As Integer = Round(cx + Cos(angle) * radius)
		    Var axY As Integer = Round(cy + Sin(angle) * radius)
		    g.DrawingColor = Color.Gray
		    g.DrawLine(cx, cy, axX, axY)
		    
		    Var labelX As Integer = Round(cx + Cos(angle) * (radius + labelOffset))
		    Var labelY As Integer = Round(cy + Sin(angle) * (radius + labelOffset))
		    g.DrawingColor = Color.Black
		    'g.DrawText(headers(i), labelX - 20, labelY, 80)
		    g.DrawText(headers(i), labelX - 20, labelY,120 ) // Width: 80px, Height: single-line
		    
		    
		  Next
		  
		  // 🕷️ Build radar path
		  Var path As New GraphicsPath
		  Var startX, startY As Integer
		  
		  For i As Integer = 0 To dimCount - 1
		    Var angle As Double = i / dimCount * 2.0 * Pi
		    Var r As Double = values(i) * radius * 0.95
		    Var x As Integer = Round(cx + Cos(angle) * r)
		    Var y As Integer = Round(cx + Sin(angle) * r)
		    
		    If i = 0 Then
		      path.MoveToPoint(x, y)
		      startX = x
		      startY = y
		    Else
		      path.AddLineToPoint(x, y)
		    End If
		  Next
		  path.AddLineToPoint(startX, startY)
		  
		  // ✨ Fill and outline radar shape
		  Var FillColor As Color = Color.RGBA(30, 144, 255, 128)
		  g.DrawingColor = FillColor
		  g.FillPath(path, True)
		  
		  g.DrawingColor = Color.RGBA(30, 144, 255, 255)
		  g.DrawPath(path)
		  
		  // 📍 Min/Max markers with outline
		  For Each idx As Integer In Array(minIdx, maxIdx)
		    Var angle As Double = idx / dimCount * 2.0 * Pi
		    Var r As Double = values(idx) * radius * 0.95
		    Var mx As Integer = Round(cx + Cos(angle) * r)
		    Var my As Integer = Round(cy + Sin(angle) * r)
		    
		    g.DrawingColor = If(idx = minIdx, Color.Red, Color.Green)
		    g.FillOval(mx - 6, my - 6, 12, 12)
		    g.DrawingColor = If(idx = minIdx, Color.Black, Color.White)
		    g.DrawOval(mx - 6, my - 6, 12, 12)
		  Next
		  
		  Return chartPic
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub DrawColumnTicks(g As Graphics, bounds As Rect, spacing As Integer)
		  For i As Integer = 0 To bounds.Width Step spacing
		    Var x As Integer = bounds.Left + i
		    g.DrawLine(x, bounds.Bottom, x, bounds.Bottom + 5)
		  Next
		  End Sub
		  
		  Sub DrawRowTicks(g As Graphics, bounds As Rect, spacing As Integer)
		    For i As Integer = 0 To bounds.Height Step spacing
		      Var y As Integer = bounds.Top + i
		      g.DrawLine(bounds.Left - 5, y, bounds.Left, y)
		    Next
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub DrawDiagnosticOverlay(g As Graphics, message As String, bounds As Rect)
		  g.ForeColor = &cDDDDDD
		  g.FillRectangle(bounds.Left, bounds.Top, bounds.Width, bounds.Height)
		  
		  g.ForeColor = Color.Red
		  g.DrawText(message, bounds.Left + 10, bounds.Top + 20)
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub DrawScatterCell(g As Graphics, x() As Double, y() As Double, bounds As Rect)
		  Var xMin As Double = getMin(x)
		  Var xMax As Double = getMax(x)
		  Var yMin As Double = getMin(y)
		  Var yMax As Double = getMax(y)
		  
		  For i As Integer = 0 To x.LastIndex
		    Var px As Double = bounds.Left + ((x(i) - xMin) / (xMax - xMin)) * bounds.Width
		    Var py As Double = bounds.Top + bounds.Height - ((y(i) - yMin) / (yMax - yMin)) * bounds.Height
		    g.DrawOval(px, py, 2, 2)
		  Next
		  g.DrawRect(bounds.Left, bounds.Top, bounds.Width, bounds.Height)
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Function DrawScatterplot(xVals() As Double, yVals() As Double, xMin As Double, xMax As Double, yMin As Double, yMax As Double, cellSize As Integer = 100) As Picture
		  // Public Function DrawScatterplot(xVals() As Double, yVals() As Double, xMin As Double, xMax As Double, yMin As Double, yMax As Double, cellSize As Integer = 100) As Picture
		  
		  Var padding As Integer = 8
		  Var plotSize As Integer = cellSize - 2 * padding
		  Var pic As New Picture(cellSize, cellSize)
		  Var g As Graphics = pic.Graphics
		  
		  
		  If xVals.Count = 0 Or yVals.Count = 0 Then
		    System.DebugLog("⚠️ Data missing for one or both axes.")
		  End If
		  
		  // Draw each point scaled into cell
		  g.DrawingColor = Color.Purple
		  For i As Integer = 0 To Min(xVals.LastIndex, yVals.LastIndex)
		    If xMax > xMin And yMax > yMin Then
		      Var normX As Double = (xVals(i) - xMin) / (xMax - xMin)
		      Var normY As Double = (yVals(i) - yMin) / (yMax - yMin)
		      Var px As Integer = Round(padding + normX * plotSize)
		      Var py As Integer = Round(padding + (1.0 - normY) * plotSize) // Y-axis is flipped
		      
		      g.FillOval(px - 2, py - 2, 4, 4)
		    End If
		  Next
		  
		  Return pic
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function GetMax(arr() As Double) As Double
		  // Function GetMax(arr() As Double) As Double
		  If arr.Count = 0 Then Return 0
		  Var maxVal As Double = arr(0)
		  For Each v As Double In arr
		    If v > maxVal Then maxVal = v
		  Next
		  Return maxVal
		  
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function GetMin(arr() As Double) As Double
		  // Function GetMin(arr() As Double) As Double
		  If arr.Count = 0 Then Return 0
		  Var minVal As Double = arr(0)
		  For Each v As Double In arr
		    If v < minVal Then minVal = v
		  Next
		  Return minVal
		  
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function GetNumericColumn(dataDict As Dictionary, key As String) As Double()
		  Var result() As Double
		  If dataDict.HasKey(key) Then
		    Var rawValues() As String = dataDict.Value(key)
		    For Each item As String In rawValues
		      Try
		        result.Add(CDbl(item.Trim))
		      Catch
		        ' Skip non-numeric values
		      End Try
		    Next
		  End If
		  Return result
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Function IsStrictNumeric(s As String) As Boolean
		  Try
		    Var d As Double = s.ToDouble
		    Return True
		  Catch
		    Return False
		  End Try
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub SetData(headerNames() As String, Data As Dictionary)
		  resultsListBox.RemoveAllRows
		  resultsListBox.ColumnCount = headerNames.Count
		  
		  // Set column titles
		  For col As Integer = 0 To headerNames.LastIndex
		    resultsListBox.HeaderAt(col) = headerNames(col)
		  Next
		  // Find the max number of rows to display
		  Var maxRows As Integer = 0
		  For Each header As String In headerNames
		    Var values() As String = Data.Value(header)
		    If values.Count > maxRows Then maxRows = values.Count
		  Next
		  
		  // Add rows of numeric data only
		  For row As Integer = 0 To maxRows - 1
		    resultsListBox.AddRow("")
		    For col As Integer = 0 To headerNames.LastIndex
		      Var header As String = headerNames(col)
		      Var values() As String = Data.Value(header)
		      If row < values.Count Then
		        Var value As String = values(row)
		        If IsStrictNumeric(value) Then
		          resultsListBox.CellTextAt(row, col) = value
		        Else
		          resultsListBox.CellTextAt(row, col) = ""
		        End If
		      End If
		    Next
		  Next
		  
		  headerData = Data
		  headers =  headerNames
		  ' messagebox("listbox completed")
		End Sub
	#tag EndMethod


	#tag Note, Name = Description
		A comprehensive StatisticalAnalyzer class for Xojo 2025 that includes:Description
		Statistical Methods:
		
		Descriptive Statistics: Mean, median, standard deviation, quartiles, skewness, kurtosis
		Normality Testing: Anderson-Darling test with p-values
		T-Tests: One-sample, two-sample (pooled and Welch's), and paired t-tests
		Linear Regression: With correlation, R², significance testing
		
		Example Usage:
		Var analyzer As New StatisticalAnalyzer
		Var data() As Double = Array(1.2, 2.3, 1.8, 2.1, 1.9, 2.4, 1.7, 2.2)
		
		// Descriptive statistics
		Var stats As Dictionary = analyzer.DescriptiveStatistics(data)
		
		// Test for normality
		Var normalityTest As Dictionary = analyzer.AndersonDarlingTest(data)
		
		// Create visualizations
		Var boxPlot As Picture = analyzer.CreateBoxPlot(data, "Sample Data")
		Var histogram As Picture = analyzer.CreateHistogram(data, "Distribution", 10)
		Var qqPlot As Picture = analyzer.CreateQQPlot(data, "Normality Check")
		The class uses native Xojo graphics and provides publication-quality output with proper statistical rigor. Would you like me to add any specific features or create example usage code for particular analyses?RetryClaude does not have the ability to run the code it generates yet.Claude can make mistakes. Please double-check responses. Sonnet 4
		
	#tag EndNote


	#tag Property, Flags = &h0
		headerData As Dictionary
	#tag EndProperty

	#tag Property, Flags = &h0
		Headers() As String
	#tag EndProperty


	#tag Structure, Name = PointF, Flags = &h0
		x as Double
		y as Double
	#tag EndStructure


#tag EndWindowCode

#tag Events PieBevelButton
	#tag Event
		Sub Pressed()
		  
		  ImageViewer1.Image = CreatePieChartImage(headers, headerData, 100)
		  
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events PieBevelButton1
	#tag Event
		Sub Pressed()
		  
		  ImageViewer1.Image = CreateSpiderPlot(headers, headerData, 100)
		  
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events SPMatrixButton
	#tag Event
		Sub Pressed()
		  
		  ImageViewer1.Image = CreateScatterplotMatrix(headers, headerData,100)
		  
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events SPMatrixButton1
	#tag Event
		Sub Pressed()
		  
		  ImageViewer1.Image = CreateScatterplotMatrix(headers, headerData,100)
		  
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events Heatmap_BevelButton
	#tag Event
		Sub Pressed()
		  ImageViewer1.Image = CreateFullCorrelationHeatmapPicture(headers, headerData)
		  
		End Sub
	#tag EndEvent
#tag EndEvents
#tag ViewBehavior
	#tag ViewProperty
		Name="Name"
		Visible=true
		Group="ID"
		InitialValue=""
		Type="String"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Interfaces"
		Visible=true
		Group="ID"
		InitialValue=""
		Type="String"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Super"
		Visible=true
		Group="ID"
		InitialValue=""
		Type="String"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Width"
		Visible=true
		Group="Size"
		InitialValue="600"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Height"
		Visible=true
		Group="Size"
		InitialValue="400"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MinimumWidth"
		Visible=true
		Group="Size"
		InitialValue="64"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MinimumHeight"
		Visible=true
		Group="Size"
		InitialValue="64"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MaximumWidth"
		Visible=true
		Group="Size"
		InitialValue="32000"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MaximumHeight"
		Visible=true
		Group="Size"
		InitialValue="32000"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Type"
		Visible=true
		Group="Frame"
		InitialValue="0"
		Type="Types"
		EditorType="Enum"
		#tag EnumValues
			"0 - Document"
			"1 - Movable Modal"
			"2 - Modal Dialog"
			"3 - Floating Window"
			"4 - Plain Box"
			"5 - Shadowed Box"
			"6 - Rounded Window"
			"7 - Global Floating Window"
			"8 - Sheet Window"
			"9 - Modeless Dialog"
		#tag EndEnumValues
	#tag EndViewProperty
	#tag ViewProperty
		Name="Title"
		Visible=true
		Group="Frame"
		InitialValue="Untitled"
		Type="String"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasCloseButton"
		Visible=true
		Group="Frame"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasMaximizeButton"
		Visible=true
		Group="Frame"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasMinimizeButton"
		Visible=true
		Group="Frame"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasFullScreenButton"
		Visible=true
		Group="Frame"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasTitleBar"
		Visible=true
		Group="Frame"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Resizeable"
		Visible=true
		Group="Frame"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Composite"
		Visible=false
		Group="OS X (Carbon)"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MacProcID"
		Visible=false
		Group="OS X (Carbon)"
		InitialValue="0"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="FullScreen"
		Visible=true
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="DefaultLocation"
		Visible=true
		Group="Behavior"
		InitialValue="2"
		Type="Locations"
		EditorType="Enum"
		#tag EnumValues
			"0 - Default"
			"1 - Parent Window"
			"2 - Main Screen"
			"3 - Parent Window Screen"
			"4 - Stagger"
		#tag EndEnumValues
	#tag EndViewProperty
	#tag ViewProperty
		Name="Visible"
		Visible=true
		Group="Behavior"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="ImplicitInstance"
		Visible=true
		Group="Window Behavior"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasBackgroundColor"
		Visible=true
		Group="Background"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="BackgroundColor"
		Visible=true
		Group="Background"
		InitialValue="&cFFFFFF"
		Type="ColorGroup"
		EditorType="ColorGroup"
	#tag EndViewProperty
	#tag ViewProperty
		Name="Backdrop"
		Visible=true
		Group="Background"
		InitialValue=""
		Type="Picture"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MenuBar"
		Visible=true
		Group="Menus"
		InitialValue=""
		Type="DesktopMenuBar"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MenuBarVisible"
		Visible=true
		Group="Deprecated"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
#tag EndViewBehavior
